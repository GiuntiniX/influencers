<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Influenciadores - Acesso Restrito</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚≠ê</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* === SUGEST√ÉO 1: SCROLLBAR COM CORES DO TEMA === */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #f3e8ff; }
        ::-webkit-scrollbar-thumb { background: #a855f7; border-radius: 5px; border: 2px solid #f3e8ff; }
        ::-webkit-scrollbar-thumb:hover { background: #9333ea; }
        
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #f59e0b; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal { transition: opacity 0.3s ease-in-out; }
        .modal.show { opacity: 1; pointer-events: auto; }
        .modal.show .modal-content { transform: scale(1); transition: transform 0.3s ease-in-out; }  
        .instagram-icon { fill: url(#instagram-gradient); }
        #scrollTopBtn { transition: opacity 0.3s, transform 0.3s; }

        /* === SUGEST√ÉO 3: ANIMA√á√ÉO DE ABERTURA DOS FILTROS (DROPDOWN) === */
        .multi-select-dropdown {
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
            transform: scale(0.95) translateY(-10px);
            transform-origin: top;
            opacity: 0;
            pointer-events: none;
        }
        .multi-select-dropdown.is-open {
            transform: scale(1) translateY(0);
            opacity: 1;
            pointer-events: auto;
        }
        
        .btn-disabled { opacity: 0.5; cursor: not-allowed; }

        /* UX: Estilos para o bot√£o de navega√ß√£o do modal */
        .modal-nav-btn {
            position: absolute; top: 50%; transform: translateY(-50%); z-index: 10;
            background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(4px);
            border-radius: 9999px; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.2s; cursor: pointer;
        }
        .modal-nav-btn:hover:not(:disabled) { background-color: white; transform: translateY(-50%) scale(1.1); }
        .modal-nav-btn:disabled { opacity: 0.3; cursor: not-allowed; transform: translateY(-50%) scale(1); }
        
        /* --- AJUSTE UX: P√çLULAS AGRUPADAS VERTICALMENTE --- */
        #filter-pills-container, #filter-pills-couples-container {
            display: flex; flex-direction: column; gap: 0.75rem; overflow-x: hidden; flex-wrap: nowrap; padding-bottom: 0;
        }
        .pill-group { display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem; }
        .pill-group-label { font-weight: 600; font-size: 0.875rem; color: #475569; }
        .pill-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }

        /* === SUGEST√ÉO 2: ANIMA√á√ïES DE "LOAD-IN" PARA OS CARDS === */
        @keyframes fadeInSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .card-animate { opacity: 0; animation: fadeInSlideUp 0.5s ease-out forwards; }
        
        /* === SUGEST√ÉO 5: BOT√ÉO 3D ELEGANTE (NOVO) === */
        .btn-3d-purple {
            background-color: #9333ea; border: none; box-shadow: 0 4px #6b21a8;
            color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500;
            transform: translateY(0); transition: all 0.15s ease-out;
        }
        .btn-3d-purple:hover { background-color: #a855f7; transform: translateY(-2px); box-shadow: 0 6px #6b21a8; }
        .btn-3d-purple:active { background-color: #7e22ce; transform: translateY(2px); box-shadow: 0 2px #6b21a8; }
        
        /* ANIMA√á√ÉO DE SHAKE PARA ERRO DE SENHA */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-100 via-orange-100 to-fuchsia-100">

    <!-- ========================================== -->
    <!-- TELA DE LOGIN (NOVO) -->
    <!-- ========================================== -->
    <div id="login-screen" class="fixed inset-0 z-[100] bg-gradient-to-br from-purple-900 via-fuchsia-900 to-amber-700 flex flex-col justify-center items-center p-4">
        <div class="bg-white/10 backdrop-blur-lg border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center">
            
            <div class="mb-6 flex justify-center">
                <div class="bg-white px-8 py-4 rounded-xl shadow-lg">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Terra_Logo.png/1200px-Terra_Logo.png" alt="Logo Terra" class="h-12 w-auto">
                </div>
            </div>

            <h1 class="text-3xl font-bold text-white mb-2">Acesso Restrito</h1>
            <p class="text-purple-200 mb-6">Utilize a senha para entrar no Painel</p>

            <form id="login-form" class="space-y-4" onsubmit="event.preventDefault(); checkPassword();">
                <div class="relative">
                    <input type="password" id="password-input" 
                        class="w-full px-4 py-3 rounded-lg bg-white/90 border-0 focus:ring-2 focus:ring-amber-400 focus:outline-none text-slate-800 placeholder-slate-500 transition-all pr-12" 
                        placeholder="Digite a senha de acesso..." autofocus>
                    
                    <!-- Bot√£o de Ver Senha (NOVO) -->
                    <button type="button" id="toggle-password-btn" class="absolute inset-y-0 right-0 px-3 flex items-center text-slate-500 hover:text-slate-700 focus:outline-none">
                        <!-- √çcone Olho Fechado (Padr√£o) -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" id="eye-open" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                        <!-- √çcone Olho Aberto -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" id="eye-closed" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                        </svg>
                    </button>
                </div>
                
                <button type="submit" id="login-submit-btn"
                    class="w-full py-3 px-4 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-bold rounded-lg shadow-lg transform transition hover:-translate-y-1 hover:shadow-xl flex justify-center items-center gap-2">
                    <span>Entrar no Painel</span>
                    <svg id="btn-spinner" class="animate-spin h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>

            <p id="login-error" class="hidden mt-4 text-red-200 bg-red-900/50 py-2 px-3 rounded text-sm font-medium border border-red-500/50">
                Senha incorreta. Tente novamente.
            </p>
        </div>
        <p class="text-white/30 mt-8 text-xs">¬© Terra Influenciadores - √Årea Confidencial</p>
    </div>

    <!-- ========================================== -->
    <!-- CONTE√öDO PRINCIPAL (AGORA PROTEGIDO) -->
    <!-- ========================================== -->
    <div id="app-content" class="hidden transition-opacity duration-700 opacity-0">

        <svg style="width:0;height:0;position:absolute;">
          <defs>
            <radialGradient id="instagram-gradient" cx="0.3" cy="1.2" r="1.2">
              <stop offset="0%" stop-color="#fdc162"/><stop offset="30%" stop-color="#f5813e"/><stop offset="60%" stop-color="#e1306c"/><stop offset="100%" stop-color="#833ab4"/>
            </radialGradient>
            
            <symbol id="icon-instagram" viewBox="0 0 24 24">
              <title>Instagram</title>
              <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.784.305-1.459.717-2.126 1.384S.935 3.356.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.785.718 1.46 1.384 2.126.667.666 1.341 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.785-.305 1.46-.718 2.126-1.384.666-.667 1.079-1.341 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.148-.558-2.913-.305-.784-.718-1.459-1.384-2.126C21.313.935 20.644.522 19.86.217 19.094-.083 18.225-.285 16.947-.344 15.667-.401 15.26-.417 12-.417h0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227a3.81 3.81 0 01-.899 1.382 3.81 3.81 0 01-1.38.899c-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421a3.81 3.81 0 01-1.381-.899 3.81 3.81 0 01-.899-1.38c-.164-.421-.36-1.065-.42-2.235-.058-1.274-.07-1.649-.07-4.859 0-3.211.015-3.586.07-4.859.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.422-.164 1.066-.36 2.235-.413 1.274-.057 1.65-.07 4.859-.07zM12 6.865a5.135 5.135 0 100 10.27 5.135 5.135 0 000-10.27zm0 8.468a3.333 3.333 0 110-6.666 3.333 3.333 0 010 6.666zm5.338-9.87a1.2 1.2 0 100 2.4 1.2 1.2 0 000-2.4z"/>
            </symbol>
            
          </defs>
        </svg>

        <div class="container mx-auto p-4 md:p-8">
            <header class="text-center mb-10 relative">
               <button id="help-btn" aria-label="Ajuda e Guia R√°pido" class="absolute top-0 left-0 bg-purple-200 text-purple-800 w-10 h-10 rounded-full flex items-center justify-center hover:bg-purple-300 transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>

                <!-- Bot√£o de LOGOUT (NOVO) -->
                <button id="logout-btn" onclick="logout()" aria-label="Sair do Painel" class="absolute top-0 right-0 bg-red-100 text-red-800 w-10 h-10 rounded-full flex items-center justify-center hover:bg-red-200 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500" title="Sair do Painel">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                </button>

                <div class="flex justify-center items-center gap-4">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/2/23/Terra_Logo.png" alt="Logo Terra" class="h-8 md:h-12 w-auto">
                    <h1 class="text-3xl md:text-5xl font-bold text-purple-900">
                        <span aria-hidden="true">|</span>
                        Painel de Influenciadores
                    </h1>
                </div>
                <p class="text-fuchsia-800 mt-3 text-lg">Encontre o influenciador ideal para sua campanha.</p>

                <div class="mt-4 flex justify-center space-x-4" role="tablist" aria-label="Navega√ß√£o principal">
                    <button id="show-influencers-btn" role="tab" aria-selected="true" aria-controls="main-panel" class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition-colors">
                        Painel Principal
                    </button>
                    <button id="show-couples-btn" role="tab" aria-selected="false" aria-controls="couples-panel" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors">
                        Casais de Influenciadores
                    </button>
                </div>
            </header>

            <main>
                <div id="main-panel" role="tabpanel" aria-labelledby="show-influencers-btn">
                     <aside class="relative z-10 bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-lg mb-6" id="filters-container">
                        <div class="flex flex-col sm:flex-row gap-4 mb-6">
                            <div class="relative flex-grow">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></div>
                                <input type="text" id="search-input" class="w-full p-3 pl-10 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all duration-300 text-slate-800 placeholder-slate-400" placeholder="Buscar por nome ou @...">
                            </div>
                            <button id="clear-filters-btn" class="flex-shrink-0 bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                Limpar Filtros
                            </button>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4" id="filters-grid">
                        </div>
                        
                        <div id="filter-pills-container" class="flex gap-2 mt-4" aria-label="Filtros ativos"></div>

                    </aside>

                    <div class="mb-6 text-right">
                        <p class="text-slate-600" aria-live="polite">
                            <strong id="influencer-count" class="font-bold text-slate-800">0</strong> influenciadores encontrados
                        </p>
                    </div>

                    <div id="loader" class="flex justify-center items-center py-10" role="status"><div class="loader"></div></div>
                    <div id="influencers-list" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                    <div id="loader-more" class="hidden justify-center items-center py-10" role="status"><div class="loader"></div></div>
                    <p id="no-results" class="hidden text-center text-slate-500 mt-10 text-lg" role="status">Nenhum influenciador encontrado.</p>
                </div>

                <div id="couples-panel" class="hidden" role="tabpanel" aria-labelledby="show-couples-btn">
                    <aside class="relative z-10 bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-lg mb-6" id="filters-container-couples">
                        <div class="flex flex-col sm:flex-row gap-4 mb-6">
                            <div class="relative flex-grow">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="w-5 h-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></div>
                                <input type="text" id="search-input-couples" class="w-full p-3 pl-10 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all duration-300 text-slate-800 placeholder-slate-400" placeholder="Buscar por nome do casal ou membro...">
                            </div>
                             <button id="clear-filters-couples-btn" class="flex-shrink-0 bg-slate-200 text-slate-700 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                Limpar Filtros
                            </button>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4" id="filters-grid-couples">
                        </div>
                        
                        <div id="filter-pills-couples-container" class="flex gap-2 mt-4" aria-label="Filtros ativos"></div>

                    </aside>

                    <div class="mb-6 text-right">
                        <p class="text-slate-600" aria-live="polite">
                            <strong id="couple-count" class="font-bold text-slate-800">0</strong> casais encontrados
                        </p>
                    </div>

                    <div id="couples-list" class="space-y-6"></div>
                    <div id="loader-more-couples" class="hidden justify-center items-center py-10" role="status"><div class="loader"></div></div>
                    <p id="no-results-couples" class="hidden text-center text-slate-500 mt-10 text-lg" role="status">Nenhum casal encontrado.</p>
                </div>
            </main>
        </div>

        <div id="influencer-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4 opacity-0 pointer-events-none"
             role="dialog"
             aria-modal="true">
        </div>

        <div id="help-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4 opacity-0 pointer-events-none"
             role="dialog"
             aria-modal="true"
             aria-labelledby="help-modal-title">

            <div class="modal-content bg-white text-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95 p-8 relative">
               <button id="close-help-btn" aria-label="Fechar ajuda" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition-colors">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <h2 id="help-modal-title" class="text-2xl font-bold text-purple-900 mb-6">Guia R√°pido do Painel</h2>

                <div class="space-y-8">
                    
                    <div class="flex items-start gap-5">
                        <div class="flex-shrink-0 bg-amber-100 text-amber-700 rounded-lg p-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6-4.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-fuchsia-800 mb-2">Filtrando sua Busca</h3>
                            <ul class="list-disc list-inside space-y-2 text-slate-700">
                                <li><strong>Sele√ß√£o M√∫ltipla:</strong> Clique em um filtro para abrir a lista e marque v√°rias op√ß√µes.</li>
                                <li><strong>Busca Interna:</strong> Todos os filtros possuem uma busca para voc√™ achar op√ß√µes rapidamente.</li>
                                <li><strong>Filtros Ativos (P√≠lulas):</strong> Os filtros selecionados aparecem agrupados por tipo. Clique no "x" para remover um filtro.</li>
                                <li><strong>Filtros Din√¢micos:</strong> O filtro "Tags" √© atualizado automaticamente. Ele s√≥ mostrar√° tags que pertencem aos influenciadores que batem com os *outros* filtros (como Segmento).</li>
                                <li><strong>Limpar Tudo:</strong> O bot√£o "Limpar Filtros" remove todas as sele√ß√µes e limpa a busca.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flex items-start gap-5">
                        <div class="flex-shrink-0 bg-green-100 text-green-700 rounded-lg p-3">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H7a3 3 0 00-3 3v8a3 3 0 003 3z" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-fuchsia-800 mb-2">Entendendo os Cards</h3>
                            <ul class="list-disc list-inside space-y-2 text-slate-700">
                                <li><strong>Seguidores:</strong> <code class="bg-slate-200 text-sm rounded px-1">M</code> = <strong>Milh√µes</strong>, <code class="bg-slate-200 text-sm rounded px-1">mil</code> = <strong>Mil</strong>.</li>
                                <li><strong>Link do Perfil:</strong> O bal√£o com o <code class="bg-slate-200 text-sm rounded px-1">@</code> √© um link clic√°vel que leva diretamente ao perfil do Instagram.</li>
                                <li><strong>Detalhes:</strong> Clique em "Ver Detalhes" para abrir um modal com a bio, or√ßamento, escopo e mais.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flex items-start gap-5">
                        <div class="flex-shrink-0 bg-sky-100 text-sky-700 rounded-lg p-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-fuchsia-800 mb-2">Navegando na Ferramenta</h3>
                            <ul class="list-disc list-inside space-y-2 text-slate-700">
                                <li><strong>Abas:</strong> Alterne entre <strong>"Painel Principal"</strong> e <strong>"Casais"</strong> no topo.</li>
                                <li><strong>Scroll Infinito:</strong> Role a tela para baixo e mais resultados ser√£o carregados automaticamente.</li>
                                <li><strong>Voltar ao Topo:</strong> Role a p√°gina para baixo e um <strong>bot√£o roxo com uma seta</strong> aparecer√°. Clique nele para voltar ao topo.</li>
                                <li><strong>Navega√ß√£o no Modal:</strong> Dentro dos "Detalhes", use as setas <kbd>&lt;</kbd> e <kbd>&gt;</kbd> para ver o influenciador anterior ou pr√≥ximo da sua lista filtrada.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button id="scrollTopBtn" aria-label="Voltar ao topo" class="hidden fixed bottom-5 right-5 bg-purple-600 text-white p-3 rounded-full shadow-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 transform hover:scale-110">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
            </svg>
        </button>
    </div> <!-- FIM DO WRAPPER DE CONTE√öDO -->

<script src="dados.js"></script>

<script>
    // ==========================================
    // SCRIPT DE LOGIN
    // ==========================================
    const ENCRYPTED_PASS = "VGVycmFJbmZsdWVuY2Vycw=="; 
    const SESSION_KEY = "terra_influencers_auth";

    // Toggle Password Visibility
    const togglePasswordBtn = document.getElementById('toggle-password-btn');
    const passwordInput = document.getElementById('password-input');
    const eyeOpen = document.getElementById('eye-open');
    const eyeClosed = document.getElementById('eye-closed');

    if (togglePasswordBtn) {
        togglePasswordBtn.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // Toggle icons
            if (type === 'text') {
                eyeOpen.classList.remove('hidden');
                eyeClosed.classList.add('hidden');
            } else {
                eyeOpen.classList.add('hidden');
                eyeClosed.classList.remove('hidden');
            }
        });
    }

    async function checkPassword() {
        const input = document.getElementById('password-input');
        const errorMsg = document.getElementById('login-error');
        const submitBtn = document.getElementById('login-submit-btn');
        const btnSpinner = document.getElementById('btn-spinner');
        const btnText = submitBtn.querySelector('span');
        
        // Estado de "Carregando"
        submitBtn.disabled = true;
        submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
        btnSpinner.classList.remove('hidden');
        btnText.textContent = "Verificando...";

        // Pequeno delay artificial para UX (sensa√ß√£o de verifica√ß√£o)
        await new Promise(r => setTimeout(r, 400));

        // Verifica√ß√£o usando Base64 (btoa) para n√£o deixar a senha crua no c√≥digo
        if (btoa(input.value) === ENCRYPTED_PASS) {
            // Sucesso
            errorMsg.classList.add('hidden');
            
            // Salvar na sess√£o (para n√£o pedir senha no refresh da p√°gina)
            sessionStorage.setItem(SESSION_KEY, 'true');
            
            grantAccess();
        } else {
            // Erro
            errorMsg.classList.remove('hidden');
            input.classList.add('ring-2', 'ring-red-500', 'shake');
            setTimeout(() => input.classList.remove('shake'), 500);
            
            // Resetar bot√£o
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
            btnSpinner.classList.add('hidden');
            btnText.textContent = "Entrar no Painel";
            
            input.focus();
        }
    }

    function grantAccess() {
        const loginScreen = document.getElementById('login-screen');
        const appContent = document.getElementById('app-content');

        // Anima√ß√£o de sa√≠da
        loginScreen.style.opacity = '0';
        loginScreen.style.transition = 'opacity 0.5s ease-out';
        
        setTimeout(() => {
            loginScreen.classList.add('hidden');
            appContent.classList.remove('hidden');
            // Pequeno delay para permitir o display:block renderizar antes da opacidade
            requestAnimationFrame(() => {
                appContent.classList.remove('opacity-0');
            });
        }, 500);
    }

    function logout() {
        // Limpar sess√£o
        sessionStorage.removeItem(SESSION_KEY);
        
        // Esconder App e Mostrar Login
        const loginScreen = document.getElementById('login-screen');
        const appContent = document.getElementById('app-content');
        const passwordInput = document.getElementById('password-input');

        appContent.classList.add('opacity-0');
        
        setTimeout(() => {
            appContent.classList.add('hidden');
            loginScreen.classList.remove('hidden');
            
            // Limpar campo de senha
            passwordInput.value = '';
            
            // Anima√ß√£o de entrada do login
            requestAnimationFrame(() => {
                loginScreen.style.opacity = '1';
            });
        }, 500);
    }

    // Verificar se j√° est√° logado na sess√£o ao carregar
    window.addEventListener('load', () => {
        if (sessionStorage.getItem(SESSION_KEY) === 'true') {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-content').classList.remove('hidden');
            document.getElementById('app-content').classList.remove('opacity-0');
        }
    });

    // ==========================================
    // SCRIPT PRINCIPAL DA APLICA√á√ÉO (ORIGINAL)
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
    // --- FUN√á√ïES HELPER ---
    function debounce(func, delay = 300) {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          func.apply(this, args);
        }, delay);
      };
    }

    const colorPalette = ['bg-red-200 text-red-700', 'bg-orange-200 text-orange-700', 'bg-amber-200 text-amber-700', 'bg-yellow-200 text-yellow-700', 'bg-lime-200 text-lime-700', 'bg-green-200 text-green-700', 'bg-emerald-200 text-emerald-700', 'bg-teal-200 text-teal-700', 'bg-cyan-200 text-cyan-700', 'bg-sky-200 text-sky-700', 'bg-blue-200 text-blue-700', 'bg-indigo-200 text-indigo-700', 'bg-violet-200 text-violet-700', 'bg-purple-200 text-purple-700', 'bg-fuchsia-200 text-fuchsia-700', 'bg-pink-200 text-pink-700', 'bg-rose-200 text-rose-700'];
    const tagColorCache = {};

    function getTagColorClasses(tag) {
        if (tagColorCache[tag]) { return tagColorCache[tag]; }
        let hash = 0;
        for (let i = 0; i < tag.length; i++) { hash = tag.charCodeAt(i) + ((hash << 5) - hash); }
        const index = Math.abs(hash % colorPalette.length);
        tagColorCache[tag] = colorPalette[index];
        return tagColorCache[tag];
    }
    
    // --- FUN√á√ÉO DE COR PARA P√çLULAS ---
    function getPillColorClasses(filterType) {
        switch (filterType) {
            case 'Busca':
                return ['bg-slate-200 text-slate-700', 'hover:bg-slate-300'];
            case 'Segmento':
                return ['bg-amber-200 text-amber-800', 'hover:bg-amber-300'];
            case 'Tags':
                return ['bg-fuchsia-200 text-fuchsia-800', 'hover:bg-fuchsia-300'];
            case 'Rede Social':
                return ['bg-sky-200 text-sky-700', 'hover:bg-sky-300'];
            case 'Or√ßamento':
                return ['bg-green-200 text-green-700', 'hover:bg-green-300'];
            case 'Projetos':
                return ['bg-indigo-200 text-indigo-700', 'hover:bg-indigo-300'];
            case 'Ag√™ncia':
                return ['bg-rose-200 text-rose-700', 'hover:bg-rose-300'];
            default:
                return ['bg-purple-200 text-purple-800', 'hover:bg-purple-300'];
        }
    }

    // --- SELETORES DOM ---
    const mainPanel = document.getElementById('main-panel'),
          influencersList = document.getElementById('influencers-list'),
          loader = document.getElementById('loader'),
          loaderMore = document.getElementById('loader-more'),
          noResults = document.getElementById('no-results'),
          searchInput = document.getElementById('search-input'),
          influencerCount = document.getElementById('influencer-count'),
          filtersGrid = document.getElementById('filters-grid'),
          clearFiltersBtn = document.getElementById('clear-filters-btn');

    const couplesPanel = document.getElementById('couples-panel'),
          couplesList = document.getElementById('couples-list'),
          loaderMoreCouples = document.getElementById('loader-more-couples'),
          noResultsCouples = document.getElementById('no-results-couples'),
          searchInputCouples = document.getElementById('search-input-couples'),
          coupleCount = document.getElementById('couple-count'),
          filtersGridCouples = document.getElementById('filters-grid-couples'),
          clearFiltersCouplesBtn = document.getElementById('clear-filters-couples-btn');

    const showInfluencersBtn = document.getElementById('show-influencers-btn'),
          showCouplesBtn = document.getElementById('show-couples-btn'),
          scrollTopBtn = document.getElementById('scrollTopBtn'),
          helpBtn = document.getElementById('help-btn');

    const influencerModal = document.getElementById('influencer-modal');
    const helpModal = document.getElementById('help-modal');
    const closeHelpBtn = document.getElementById('close-help-btn');

    // --- VARI√ÅVEIS DE ESTADO ---
    let allInfluencers = [], allCouples = [];
    let currentFilteredInfluencers = [], currentPageInfluencers = 1, itemsPerPageInfluencers = 24, isLoadingInfluencers = false;
    let currentFilteredCouples = [], currentPageCouples = 1, itemsPerPageCouples = 4, isLoadingCouples = false;
    let focusedElementBeforeModal;

    // --- FUN√á√ïES DE PROCESSAMENTO DE DADOS ---
    function parseFollowers(str) { if (!str || typeof str !== 'string' || str.trim() === '-') return 0; const c = str.toLowerCase().replace(',', '.').trim(); if (c.includes('m')) return parseFloat(c.replace('m', '')) * 1e6; if (c.includes('mil')) return parseFloat(c.replace('mil', '')) * 1e3; return parseFloat(c); }
    function formatNumber(num) { if (num === 0) return 'N/A'; if (num >= 1e6) return (num / 1e6).toFixed(1).replace('.0', '') + 'M'; if (num >= 1e3) return (num / 1e3).toFixed(0) + ' mil'; return num.toString(); }
    function parseOrcamento(str) { if (!str || typeof str !== 'string' || str.trim() === '-' || str.trim() === 'N/A') return 0; return parseFloat(String(str).replace(/R\$|R4|\./g, '').replace(',', '.').trim()); }

    function processData(data) {
        return data.filter(item => item && item.INFLUENCIADOR && item.INFLUENCIADOR.trim() !== "").map(item => {
            const followers = { ig: parseFollowers(item.IG), ttk: parseFollowers(item.TTK), yt: parseFollowers(item.YT) };
            let primarySocial = 'Instagram';
            if (followers.ttk > followers.ig && followers.ttk > followers.yt) primarySocial = 'TikTok';
            else if (followers.yt > followers.ig && followers.yt > followers.ttk) primarySocial = 'YouTube';
            const tagsSecundarias = item['SEGMENTO SECUND√ÅRIO'] ? item['SEGMENTO SECUND√ÅRIO'].split(',').map(tag => tag.trim().charAt(0).toUpperCase() + tag.trim().slice(1)) : [];
            return {'Influenciador': item.INFLUENCIADOR, '@': item['@'], 'IMAGEM_URL': item.IMAGEM_URL || '', 'IG': item.IG || 'N/A', 'TTK': item.TTK || 'N/A', 'YT': item.YT || 'N/A', 'Rede Social': primarySocial, 'FollowersIG': followers.ig, 'FollowersTTK': followers.ttk, 'FollowersYT': followers.yt, 'Segmento': item.SEGMENTO ? item.SEGMENTO.trim() : 'N/A', 'TagsSecundarias': tagsSecundarias, 'PROJETOS': item.PROJETOS ? item.PROJETOS.trim() : 'N/A', 'AG√äNCIA': item.AG√äNCIA ? item.AG√äNCIA.trim() : 'N/A', 'ESCOPO': item.ESCOPO ? item.ESCOPO.trim() : 'N/A', 'MINI BIO - INFLUENCIADOR': item['MINI BIO - INFLUENCIADOR'] ? item['MINI BIO - INFLUENCIADOR'].trim() : 'N/A', 'Or√ßamento (Aproximado)': (item['REF. VALOR'] || 'N/A').replace('R4 ', 'R$ '), 'valorNumericoOrcamento': parseOrcamento(item['REF. VALOR']), 'Link do Perfil': `https://instagram.com/${item['@']}`};
        });
    }

    function processCouplesData(data) {
        return data.map(couple => ({ ...couple, valorNumericoOrcamento: parseOrcamento(couple.REF_VALOR) }));
    }

    // --- FUN√á√ïES DE FILTRO (UI) ---

    // AJUSTE UX: Nova fun√ß√£o para reordenar op√ß√µes (selecionadas primeiro)
    function sortMultiSelectOptions(container) {
        const optionsContainer = container.querySelector('.options-list-container');
        if (!optionsContainer) return;

        const options = Array.from(optionsContainer.querySelectorAll('.option-item'));
        
        options.sort((a, b) => {
            const aChecked = a.querySelector('input[type="checkbox"]').checked;
            const bChecked = b.querySelector('input[type="checkbox"]').checked;
            
            if (aChecked && !bChecked) return -1; // a (checked) comes before b (unchecked)
            if (!aChecked && bChecked) return 1;  // b (checked) comes before a (unchecked)
            return 0; // maintain original order
        });

        // Re-append options in the new sorted order
        options.forEach(option => optionsContainer.appendChild(option));
    }


    // AJUSTE UX: Fun√ß√£o createMultiSelectFilter modificada
    // === MODIFICA√á√ÉO: Adicionado hasSearch = true como √∫ltimo par√¢metro ===
    function createMultiSelectFilter(id, placeholder, emoji, options, parentElement, changeCallback, hasSearch = true) {
        const container = document.createElement('div');
        container.id = id;
        container.className = 'relative multi-select-container';

        const button = document.createElement('button');
        button.className = 'w-full p-2.5 pl-10 pr-8 text-left bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors appearance-none focus:outline-none focus:ring-2 focus:ring-amber-500 cursor-pointer text-slate-800 flex items-center justify-between';
        button.innerHTML = `<div class="flex items-center"><span class="absolute left-3 text-lg pointer-events-none">${emoji}</span><span class="truncate button-text">${placeholder}</span></div><div class="pointer-events-none"><svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></div>`;
        button.dataset.placeholder = placeholder;

        const dropdown = document.createElement('div');
        // === SUGEST√ÉO 3: Removido 'hidden' da classe
        dropdown.className = 'multi-select-dropdown absolute w-full mt-1 bg-white rounded-md shadow-lg z-20 border border-slate-200';
        
        // === MODIFICA√á√ÉO: Adicionada verifica√ß√£o 'if (hasSearch)' ===
        if (hasSearch) {
            const searchContainer = document.createElement('div');
            searchContainer.className = 'p-2 border-b border-slate-200 sticky top-0 bg-white z-10';

            const searchInput = document.createElement('input');
            searchInput.type = 'text';
            searchInput.placeholder = `Buscar em ${placeholder}...`;
            searchInput.className = 'w-full p-2 border border-slate-300 rounded-md text-slate-700 text-sm placeholder-slate-400 focus:ring-1 focus:ring-amber-500 focus:border-amber-500';

            searchInput.addEventListener('click', (e) => e.stopPropagation());
            
            searchContainer.appendChild(searchInput);
            dropdown.appendChild(searchContainer);

            // Listener da Busca
            searchInput.addEventListener('input', () => {
                const searchTerm = searchInput.value.toLowerCase();
                const allOptions = optionsContainer.querySelectorAll('.option-item');

                allOptions.forEach(opt => {
                    const label = opt.querySelector('span.select-none');
                    if (label) {
                        const optionText = label.textContent.toLowerCase();
                        if (optionText.includes(searchTerm)) {
                            opt.style.display = '';
                        } else {
                            opt.style.display = 'none';
                        }
                    }
                });
            });
        }
        // === FIM DA MODIFICA√á√ÉO ===
        
        // AJUSTE UX: Adicionar bot√µes "Selecionar Todos" / "Limpar Todos"
        const actionsContainer = document.createElement('div');
        actionsContainer.className = 'p-2 border-b border-slate-200 flex justify-between gap-2';
        
        const selectAllBtn = document.createElement('button');
        selectAllBtn.type = 'button';
        selectAllBtn.textContent = 'Selecionar Todos';
        selectAllBtn.className = 'text-xs text-amber-600 hover:text-amber-800 font-medium';
        
        const clearAllBtn = document.createElement('button');
        clearAllBtn.type = 'button';
        clearAllBtn.textContent = 'Limpar Todos';
        clearAllBtn.className = 'text-xs text-slate-500 hover:text-slate-700 font-medium';
        
        actionsContainer.appendChild(selectAllBtn);
        actionsContainer.appendChild(clearAllBtn);
        dropdown.appendChild(actionsContainer);


        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'max-h-[200px] overflow-y-auto options-list-container';

        options.forEach(option => {
            const optionEl = document.createElement('div');
            optionEl.className = 'p-2 hover:bg-slate-100 option-item';
            optionEl.innerHTML = `
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="checkbox" value="${option.value || option}" class="form-checkbox h-4 w-4 rounded text-amber-600 focus:ring-amber-500 border-slate-300">
                    <span class="text-slate-700 select-none">${option.text || option}</span>
                </label>
            `;
            optionEl.querySelector('input').addEventListener('change', () => {
                updateMultiSelectButtonText(container);
                changeCallback();
            });
            optionsContainer.appendChild(optionEl);
        });

        dropdown.appendChild(optionsContainer);

        // --- Listeners dos novos bot√µes ---
        
        // Helper para "Selecionar/Limpar Todos" (respeita a busca)
        function setAllVisibleCheckboxes(checkedState) {
            const allOptions = optionsContainer.querySelectorAll('.option-item');
            allOptions.forEach(opt => {
                // S√≥ altera checkboxes que est√£o vis√≠veis (respeita o filtro de busca)
                if (opt.style.display !== 'none') {
                    const checkbox = opt.querySelector('input[type="checkbox"]');
                    if (checkbox) checkbox.checked = checkedState;
                }
            });
            updateMultiSelectButtonText(container);
            changeCallback();
        }

        selectAllBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            setAllVisibleCheckboxes(true);
        });
        
        clearAllBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            setAllVisibleCheckboxes(false);
        });

        container.appendChild(button);
        container.appendChild(dropdown);
        parentElement.appendChild(container);
    }

    function updateMultiSelectButtonText(container) {
         const button = container.querySelector('button');
        const buttonText = button.querySelector('.button-text');
        const checkedCount = container.querySelectorAll('input:checked').length;

        if (checkedCount > 0) {
            buttonText.textContent = `${button.dataset.placeholder} (${checkedCount})`;
        } else {
            buttonText.textContent = button.dataset.placeholder;
        }
    }

    // AJUSTE UX: Listener de clique global modificado para reordenar
    document.addEventListener('click', (e) => {
        const containers = document.querySelectorAll('.multi-select-container');
        containers.forEach(container => {
            if (!container.contains(e.target)) {
                // === SUGEST√ÉO 3: Troca .add('hidden') por .remove('is-open')
                container.querySelector('.multi-select-dropdown').classList.remove('is-open');
            } else {
                 // === SUGEST√ÉO 3: L√≥gica de toggle modificada
                 if (e.target.closest('button') && e.target.closest('button') === container.querySelector('button')) {
                    const dropdown = container.querySelector('.multi-select-dropdown');
                    
                    // Checa se ESTAVA fechado ANTES do toggle
                    const wasClosed = !dropdown.classList.contains('is-open');  
                    
                    // Faz o toggle da nova classe
                    dropdown.classList.toggle('is-open');

                    // Se estava fechado e acabou de abrir...
                    if (wasClosed) {
                        // 1. Reordena as op√ß√µes (selecionadas primeiro)
                        sortMultiSelectOptions(container);

                        // 2. Limpa a busca interna
                        const searchInput = container.querySelector('input[type="text"]');
                        if (searchInput) {
                            searchInput.value = '';
                            searchInput.dispatchEvent(new Event('input')); // Dispara o evento para mostrar todas
                        }
                    }
                 }
            }
        });
    });

    function getSelectedValues(filterId) {
         const container = document.getElementById(filterId);
        if (!container) return [];
        const checked = container.querySelectorAll('input:checked');
        return Array.from(checked).map(cb => cb.value);
    }

    function populateFilters() {
        filtersGrid.innerHTML = '';
        const segmentos = [...new Set(allInfluencers.map(i => i.Segmento).filter(Boolean).filter(s => s !== 'N/A'))].sort();
        const segmentosSecundarios = [...new Set(allInfluencers.flatMap(i => i.TagsSecundarias).filter(Boolean))].sort();
        const projetos = [...new Set(allInfluencers.map(i => i.PROJETOS).filter(Boolean).filter(s => s !== 'N/A'))].sort();
        const agencias = [...new Set(allInfluencers.map(i => i.AG√äNCIA).filter(Boolean).filter(s => s !== 'N/A'))].sort();
        const plataformas = ['Instagram', 'TikTok', 'YouTube'];
        const orcamentos = [
            {value:'ate20k', text:'At√© R$ 20 mil'}, {value:'ate50k', text:'De R$20k a R$50k'},
            {value:'ate100k', text:'De R$50k a R$100k'}, {value:'mais100k', text:'+ de R$ 100 mil'}
        ];

        createMultiSelectFilter('segmento-filter', 'Segmento', 'üé®', segmentos, filtersGrid, applyFilters);
        createMultiSelectFilter('segmento-secundario-filter', 'Tags', '‚ú®', segmentosSecundarios, filtersGrid, applyFilters);
        // === MODIFICA√á√ÉO: Adicionado 'false' para desabilitar a busca ===
        createMultiSelectFilter('plataforma-filter', 'Rede Social', 'üì±', plataformas, filtersGrid, applyFilters, false);
        createMultiSelectFilter('orcamento-filter', 'Or√ßamento', 'üí∞', orcamentos.map(o => ({ value: o.value, text: o.text })), filtersGrid, applyFilters, false);
        // === FIM DA MODIFICA√á√ÉO ===
        createMultiSelectFilter('projetos-filter', 'Projetos', 'üöÄ', projetos, filtersGrid, applyFilters);
        createMultiSelectFilter('agencia-filter', 'Ag√™ncia', 'üè¢', agencias, filtersGrid, applyFilters);
    }

    function populateCouplesFilters() {
        filtersGridCouples.innerHTML = '';
        const segmentos = [...new Set(allCouples.flatMap(c => c.MEMBROS.flatMap(m => m.SEGMENTO ? m.SEGMENTO.split(',').map(s => s.trim()) : [])).filter(Boolean))].sort();
        const projetos = [...new Set(allCouples.map(c => c.PROJETOS).filter(p => p && p.trim() !== '-' && p.trim() !== 'N/A'))].sort();
        const agencias = [...new Set(allCouples.map(c => c.AGENCIA).filter(a => a && a.trim() !== '-' && a.trim() !== 'N/A'))].sort();
        const orcamentos = [
            {value:'ate20k', text:'At√© R$ 20 mil'}, {value:'ate50k', text:'De R$20k a R$50k'},
            {value:'ate100k', text:'De R$50k a R$100k'}, {value:'mais100k', text:'+ de R$ 100 mil'}
        ];

        createMultiSelectFilter('segmento-filter-couples', 'Segmento', 'üé®', segmentos, filtersGridCouples, applyCouplesFilters);
        // === MODIFICA√á√ÉO: Adicionado 'false' para desabilitar a busca ===
        createMultiSelectFilter('orcamento-filter-couples', 'Or√ßamento', 'üí∞', orcamentos.map(o => ({ value: o.value, text: o.text })), filtersGridCouples, applyCouplesFilters, false);
        // === FIM DA MODIFICA√á√ÉO ===
        createMultiSelectFilter('projetos-filter-couples', 'Projetos', 'üöÄ', projetos, filtersGridCouples, applyCouplesFilters);
        createMultiSelectFilter('agencia-filter-couples', 'Ag√™ncia', 'üè¢', agencias, filtersGridCouples, applyCouplesFilters);
    }

    // --- FUN√á√ïES DE RENDERIZA√á√ÉO E PAGINA√á√ÉO ---
    function loadMoreInfluencers() {
        if (isLoadingInfluencers) return;
        isLoadingInfluencers = true;
        loaderMore.classList.remove('hidden');

        const start = (currentPageInfluencers - 1) * itemsPerPageInfluencers;
        const end = start + itemsPerPageInfluencers;
        const paginatedItems = currentFilteredInfluencers.slice(start, end);

        paginatedItems.forEach((influencer, index) => {
            const globalIndex = start + index;

            const name = influencer.Influenciador || '', initials = name.split(' ').map(n => n[0]).slice(0, 2).join('');
            let avatar = `<div class="w-full h-full flex items-center justify-center bg-slate-200"><span class="text-3xl font-bold text-slate-600">${initials}</span></div>`;
            if (influencer.IMAGEM_URL) avatar = `<img src="${influencer.IMAGEM_URL}" alt="${name}" class="w-full h-full object-cover">`;

            // === SUGEST√ÉO 4: Otimiza√ß√£o de SVG (Instagram)
            const arrobaHTML = `
                <div class="mt-1">
                    <a href="${influencer['Link do Perfil']}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 bg-fuchsia-100 text-fuchsia-800 rounded-full px-2.5 py-1 text-xs font-medium hover:bg-fuchsia-200 transition-colors">
                        <svg class="w-4 h-4 instagram-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><use href="#icon-instagram" /></svg>
                        <span>${influencer['@']}</span>
                    </a>
                </div>
            `;
            let segmentAndTagsHTML = '<div class="mt-2 text-sm text-slate-500 flex items-center flex-wrap justify-center sm:justify-start gap-2">';
            if (influencer.Segmento && influencer.Segmento !== 'N/A') segmentAndTagsHTML += `<span class="font-semibold inline-block py-1 px-2.5 rounded-full text-xs bg-amber-100 text-amber-800">${influencer.Segmento}</span>`;
            const tagsToShow = influencer.TagsSecundarias.slice(0, 2), remainingTags = influencer.TagsSecundarias.length - 2;
            if (tagsToShow.length > 0) {
                if (influencer.Segmento && influencer.Segmento !== 'N/A') segmentAndTagsHTML += '<span class="text-slate-300 font-light">|</span>';
                tagsToShow.forEach(tag => segmentAndTagsHTML += `<span class="font-semibold inline-block py-0.5 px-2 rounded-full text-[11px] ${getTagColorClasses(tag)}">${tag}</span>`);
                if (remainingTags > 0) segmentAndTagsHTML += `<span class="font-semibold inline-block py-0.5 px-2 rounded-full text-[11px] bg-slate-200 text-slate-600">+${remainingTags}</span>`;
            }
            segmentAndTagsHTML += '</div>';

            // === SUGEST√ÉO 4: Otimiza√ß√£o de SVG (Instagram)
            let socialMediaHTML = '<div class="mt-3 flex justify-center sm:justify-start items-center gap-x-3">';
            if (influencer.FollowersIG > 0) socialMediaHTML += `<svg class="w-5 h-5 instagram-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><use href="#icon-instagram" /></svg>`;
            if (influencer.FollowersTTK > 0) socialMediaHTML += `<svg class="w-5 h-5" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"><title>TikTok</title><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-2.43.05-4.84-.95-6.43-2.8-1.59-1.87-2.32-4.2-1.86-6.33.36-1.72 1.46-3.2 3.02-4.06.38-.2.77-.38 1.16-.52.06-1.57.02-3.14.01-4.71.13-2.59 1.91-4.86 4.42-5.63 1.25-.38 2.5-.45 3.75-.28z"/></svg>`;
            if (influencer.FollowersYT > 0) socialMediaHTML += `<svg class="w-5 h-5" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>YouTube</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .498 6.186C0 8.07 0 12 0 12s0 3.93.498 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" fill="#FF0000"/></svg>`;
            socialMediaHTML += '</div>';

            const item = document.createElement('div');
            
            // === SUGEST√ÉO 2 e 4: Adiciona 'card-animate', 'bg-white/90', 'backdrop-blur-sm', 'shadow-lg'
            item.className = 'bg-white/90 backdrop-blur-sm rounded-xl shadow-lg p-4 flex flex-col sm:flex-row items-center sm:space-x-6 transition-all duration-300 hover:shadow-xl hover:ring-2 hover:ring-amber-500 card-animate';
            
            // === SUGEST√ÉO 2: Adiciona delay de anima√ß√£o
            item.style.animationDelay = `${index * 50}ms`;

            // === ALTERA√á√ÉO DO BOT√ÉO (SUGEST√ÉO 5) ===
            // Trocamos as classes do bot√£o "bg-amber-600..." por "btn-3d-purple"
            item.innerHTML = `<div class="w-24 h-24 flex-shrink-0 rounded-full overflow-hidden bg-slate-200">${avatar}</div><div class="flex-grow text-center sm:text-left mt-4 sm:mt-0"><h3 class="text-xl font-bold text-slate-900">${name}</h3>${arrobaHTML}${segmentAndTagsHTML}${socialMediaHTML}</div><div class="flex-shrink-0 mt-4 sm:mt-0"><button class="details-btn btn-3d-purple w-full sm:w-auto">Ver Detalhes</button></div>`;
            // === FIM DA ALTERA√á√ÉO ===

            item.querySelector('.details-btn').addEventListener('click', () => openInfluencerModal(influencer, globalIndex));
            influencersList.appendChild(item);
        });

        currentPageInfluencers++;
        loaderMore.classList.add('hidden');
        isLoadingInfluencers = false;
    }

    function loadMoreCouples() {
         if (isLoadingCouples) return;
        isLoadingCouples = true;
        loaderMoreCouples.classList.remove('hidden');

        const start = (currentPageCouples - 1) * itemsPerPageCouples;
        const end = start + itemsPerPageCouples;
        const paginatedItems = currentFilteredCouples.slice(start, end);

        // === SUGEST√ÉO 2: Adicionado 'index' ao forEach
        paginatedItems.forEach((couple, index) => {
            const coupleCard = document.createElement('div');
            
            // === SUGEST√ÉO 2 e 4: Adiciona 'card-animate', 'bg-white/90', 'backdrop-blur-sm', 'shadow-xl'
            coupleCard.className = 'bg-white/90 backdrop-blur-sm rounded-xl shadow-xl p-6 transition-all duration-300 hover:shadow-2xl hover:ring-2 hover:ring-amber-500 card-animate';
            
            // === SUGEST√ÉO 2: Adiciona delay de anima√ß√£o
            coupleCard.style.animationDelay = `${index * 100}ms`;

            let membersHtml = '';
            couple.MEMBROS.forEach(member => {
                let avatarHtml = '';
                if (member.IMAGEM_URL) avatarHtml = `<img src="${member.IMAGEM_URL}" alt="Foto de ${member.NOME}" class="w-full h-full object-cover">`;
                else avatarHtml = `<div class="w-full h-full flex items-center justify-center bg-amber-100 text-amber-800"><span class="text-2xl font-bold">${member.NOME.split(' ').map(n=>n[0]).slice(0,2).join('')}</span></div>`;

                // === SUGEST√ÉO 4: Otimiza√ß√£o de SVG (Instagram)
                const arrobaHTML = `
                    <div class="mt-1">
                        <a href="https://instagram.com/${member['@']}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 bg-fuchsia-100 text-fuchsia-800 rounded-full px-2.5 py-1 text-xs font-medium hover:bg-fuchsia-200 transition-colors">
                            <svg class="w-4 h-4 instagram-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><use href="#icon-instagram" /></svg>
                            <span>${member['@']}</span>
                        </a>
                    </div>
                `;

                // === SUGEST√ÉO 4: Otimiza√ß√£o de SVG (Instagram)
                let socialIconsHtml = '<div class="mt-2 flex items-center gap-4 text-xs text-slate-700">';
                if (member.IG && member.IG.trim() !== '' && member.IG.trim() !== '-') {
                    socialIconsHtml += `<div class="flex items-center gap-1"><svg class="w-4 h-4 instagram-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><use href="#icon-instagram" /></svg><span class="font-semibold">${member.IG}</span></div>`;
                }
                if (member.TTK && member.TTK.trim() !== '' && member.TTK.trim() !== '-') {
                    socialIconsHtml += `<div class="flex items-center gap-1"><svg class="w-4 h-4" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#000000"><title>TikTok</title><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-2.43.05-4.84-.95-6.43-2.8-1.59-1.87-2.32-4.2-1.86-6.33.36-1.72 1.46-3.2 3.02-4.06.38-.2.77-.38 1.16-.52.06-1.57.02-3.14.01-4.71.13-2.59 1.91-4.86 4.42-5.63 1.25-.38 2.5-.45 3.75-.28z"/></svg><span class="font-semibold">${member.TTK}</span></div>`;
                }
                if (member.YT && member.YT.trim() !== '' && member.YT.trim() !== '-') {
                    socialIconsHtml += `<div class="flex items-center gap-1"><svg class="w-4 h-4" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>YouTube</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .498 6.186C0 8.07 0 12 0 12s0 3.93.498 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" fill="#FF0000"/></svg><span class="font-semibold">${member.YT}</span></div>`;
                }
                socialIconsHtml += '</div>';

                let memberSegmentsHtml = '';
                if (member.SEGMENTO && member.SEGMENTO.trim() !== '' && member.SEGMENTO.trim() !== '-') {
                    memberSegmentsHtml = '<div class="mt-2 flex flex-wrap gap-1">';
                    member.SEGMENTO.split(',').forEach(seg => {
                        const trimmedSeg = seg.trim();
                        if (trimmedSeg) memberSegmentsHtml += `<span class="font-semibold inline-block py-0.5 px-2 rounded-full text-[11px] ${getTagColorClasses(trimmedSeg)}">${trimmedSeg}</span>`;
                    });
                    memberSegmentsHtml += '</div>';
                }
                membersHtml += `<div class="flex-1 min-w-[250px] bg-slate-50 p-4 rounded-lg flex flex-col justify-between"><div><div class="flex items-center space-x-4"><div class="w-16 h-16 flex-shrink-0 rounded-full overflow-hidden bg-slate-200">${avatarHtml}</div><div><h4 class="font-bold text-slate-900">${member.NOME}</h4>${arrobaHTML}</div></div>${socialIconsHtml}${memberSegmentsHtml}</div></div>`;
            });
            coupleCard.innerHTML = `<div class="mb-4 text-center sm:text-left"><h2 class="text-2xl font-bold text-purple-900">${couple.NOME_CASAL}</h2><p class="text-sm text-fuchsia-800">Ag√™ncia: ${couple.AGENCIA || 'N/A'}</p></div><div class="flex flex-wrap gap-4 mb-4">${membersHtml}</div><div class="bg-amber-50 border-l-4 border-amber-500 text-amber-800 p-4 rounded-r-lg"><p class="font-bold">Proposta:</p><p><strong class="font-semibold">Valor:</strong> ${couple.REF_VALOR || 'N/A'}</p><p><strong class="font-semibold">Projeto:</strong> ${couple.PROJETOS || 'N/A'}</p><p><strong class="font-semibold">Escopo:</strong> ${couple.ESCOPO || 'N/A'}</p></div>`;
            couplesList.appendChild(coupleCard);
        });

        currentPageCouples++;
        loaderMoreCouples.classList.add('hidden');
        isLoadingCouples = false;
    }

    // --- FUN√á√ïES DE L√ìGICA DE FILTRO ---
    function updateTagFilterOptions(newOptions) {
        const filterId = 'segmento-secundario-filter';
        const container = document.getElementById(filterId);
        if (!container) return;

        const optionsContainer = container.querySelector('.options-list-container');
        if (!optionsContainer) return;

        const searchInput = container.querySelector('input[type="text"]');
        const currentSearchTerm = searchInput ? searchInput.value.toLowerCase() : '';

        const selectedValues = new Set(getSelectedValues(filterId));
        const newOptionsSet = new Set(newOptions);

        const validSelectedValues = new Set([...selectedValues].filter(val => newOptionsSet.has(val)));
        let newCheckedCount = 0;

        optionsContainer.innerHTML = '';

        newOptions.forEach(optionText => {
            const optionValue = optionText;
            const optionEl = document.createElement('div');
            optionEl.className = 'p-2 hover:bg-slate-100 option-item';

            const isChecked = validSelectedValues.has(optionValue);
            if (isChecked) newCheckedCount++;

            if (currentSearchTerm && !optionText.toLowerCase().includes(currentSearchTerm)) {
                optionEl.style.display = 'none';
            }

            optionEl.innerHTML = `
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="checkbox" value="${optionValue}" class="form-checkbox h-4 w-4 rounded text-amber-600 focus:ring-amber-500 border-slate-300" ${isChecked ? 'checked' : ''}>
                    <span class="text-slate-700 select-none">${optionText}</span>
                </label>
            `;

            optionEl.querySelector('input').addEventListener('change', () => {
                updateMultiSelectButtonText(container);
                applyFilters();
            });
            optionsContainer.appendChild(optionEl);
        });
        
        // AJUSTE UX: Re-sortear as op√ß√µes de tags (selecionadas primeiro)
        sortMultiSelectOptions(container);

        const button = container.querySelector('button');
        const buttonText = button.querySelector('.button-text');
        if (newCheckedCount > 0) {
            buttonText.textContent = `${button.dataset.placeholder} (${newCheckedCount})`;
        } else {
            buttonText.textContent = button.dataset.placeholder;
        }
    }


    function applyFilters() {
        const searchTerm = searchInput.value.toLowerCase();
        const segmentos = getSelectedValues('segmento-filter');
        const plataformas = getSelectedValues('plataforma-filter');
        const orcamentos = getSelectedValues('orcamento-filter');
        const projetos = getSelectedValues('projetos-filter');
        const agencias = getSelectedValues('agencia-filter');

        const influencersForTagOptions = allInfluencers.filter(i => {
            const matchSearch = (i.Influenciador.toLowerCase().includes(searchTerm) || i['@'].toLowerCase().includes(searchTerm));
            const matchSegmento = segmentos.length === 0 || segmentos.includes(i.Segmento);
            const matchProjeto = projetos.length === 0 || projetos.includes(i.PROJETOS);
            const matchAgencia = agencias.length === 0 || agencias.includes(i.AG√äNCIA);

            const matchPlataforma = plataformas.length === 0 || plataformas.some(p => {
                if (p === 'Instagram') return i.FollowersIG > 0;
                if (p === 'TikTok') return i.FollowersTTK > 0;
                if (p === 'YouTube') return i.FollowersYT > 0;
                return false;
            });

            const matchOrcamento = orcamentos.length === 0 || orcamentos.some(o => {
                const valor = i.valorNumericoOrcamento;
                switch (o) {
                    case 'ate20k': return valor > 0 && valor <= 20000;
                    case 'ate50k': return valor > 20000 && valor <= 50000;
                    case 'ate100k': return valor > 50000 && valor <= 100000;
                    case 'mais100k': return valor > 100000;
                    default: return false;
                }
            });

            return matchSearch && matchSegmento && matchPlataforma && matchOrcamento && matchProjeto && matchAgencia;
        });

        const availableTags = [...new Set(influencersForTagOptions.flatMap(i => i.TagsSecundarias).filter(Boolean))].sort();

        updateTagFilterOptions(availableTags);

        const segmentosSecundarios = getSelectedValues('segmento-secundario-filter');

        const filtered = influencersForTagOptions.filter(i => {
            const matchSegmentoSecundario = segmentosSecundarios.length === 0 || segmentosSecundarios.some(tag => i.TagsSecundarias.includes(tag));
            return matchSegmentoSecundario;
        });

        checkClearButtonState(searchInput, filtersGrid, clearFiltersBtn);
        
        // Atualiza as p√≠lulas
        updateFilterPills('filter-pills-container', 'filters-grid', 'search-input', applyFilters);

        filtered.sort((a, b) => b.FollowersIG - b.FollowersIG);

        currentFilteredInfluencers = filtered;
        influencerCount.textContent = currentFilteredInfluencers.length;
        noResults.classList.toggle('hidden', currentFilteredInfluencers.length > 0);
        influencersList.innerHTML = '';
        currentPageInfluencers = 1;
        loader.style.display = 'none';
        loadMoreInfluencers();
    }


    function applyCouplesFilters() {
         const searchTerm = searchInputCouples.value.toLowerCase();
        const segmentos = getSelectedValues('segmento-filter-couples');
        const orcamentos = getSelectedValues('orcamento-filter-couples');
        const projetos = getSelectedValues('projetos-filter-couples');
        const agencias = getSelectedValues('agencia-filter-couples');

        const filtered = allCouples.filter(couple => {
            const searchMatch = !searchTerm || couple.NOME_CASAL.toLowerCase().includes(searchTerm) || couple.MEMBROS.some(m => m.NOME.toLowerCase().includes(searchTerm) || m['@'].toLowerCase().includes(searchTerm));
            const segmentoMatch = segmentos.length === 0 || couple.MEMBROS.some(m => m.SEGMENTO && segmentos.some(s => m.SEGMENTO.includes(s)));
            const projetoMatch = projetos.length === 0 || projetos.includes(couple.PROJETOS);
            const agenciaMatch = agencias.length === 0 || agencias.includes(couple.AGENCIA);

            const orcamentoMatch = orcamentos.length === 0 || orcamentos.some(o => {
                const valor = couple.valorNumericoOrcamento;
                switch (o) {
                    case 'ate20k': return valor > 0 && valor <= 20000;
                    case 'ate50k': return valor > 20000 && valor <= 50000;
                    case 'ate100k': return valor > 50000 && valor <= 100000;
                    case 'mais100k': return valor > 100000;
                    default: return false;
                }
            });

            return searchMatch && segmentoMatch && projetoMatch && agenciaMatch && orcamentoMatch;
        });

        checkClearButtonState(searchInputCouples, filtersGridCouples, clearFiltersCouplesBtn);
        
        // Atualiza as p√≠lulas (Casais)
        updateFilterPills('filter-pills-couples-container', 'filters-grid-couples', 'search-input-couples', applyCouplesFilters);

        filtered.sort((a, b) => b.valorNumericoOrcamento - a.valorNumericoOrcamento);

        currentFilteredCouples = filtered;
        coupleCount.textContent = currentFilteredCouples.length;
        noResultsCouples.classList.toggle('hidden', currentFilteredCouples.length > 0);
        couplesList.innerHTML = '';
        currentPageCouples = 1;
        loadMoreCouples();
    }

    function checkClearButtonState(searchInputEl, gridContainer, clearButtonEl) {
       const hasSearchTerm = searchInputEl.value.length > 0;
        const hasActiveFilters = gridContainer.querySelectorAll('input:checked').length > 0;

       if (hasSearchTerm || hasActiveFilters) {
        clearButtonEl.disabled = false;
        clearButtonEl.classList.remove('btn-disabled');
       } else {
        clearButtonEl.disabled = true;
        clearButtonEl.classList.add('btn-disabled');
       }
    }

    function setupClearButton(button, gridContainer, searchInputEl, applyFn) {
         button.addEventListener('click', () => {
             searchInputEl.value = '';
             const filterContainers = gridContainer.querySelectorAll('.multi-select-container');
             filterContainers.forEach(container => {
                 container.querySelectorAll('input:checked').forEach(checkbox => {
                     checkbox.checked = false;
                 });
                 updateMultiSelectButtonText(container);
             });
             applyFn();
             checkClearButtonState(searchInputEl, gridContainer, button);
         });
    }

    // --- FUN√á√ïES DAS P√çLULAS DE FILTRO ---

    /**
     * AJUSTE UX: Cria um elemento de p√≠lula de filtro (SEM o prefixo de tipo).
     */
    function createPill(type, value, removeCallback) {
        // Pega as classes de cor baseadas no tipo de filtro
        const [baseClass, hoverClass] = getPillColorClasses(type);

        const pill = document.createElement('span');
        pill.className = `inline-flex items-center ${baseClass} text-xs font-medium pl-2.5 pr-1 py-1 rounded-full`;
        
        // AJUSTE: Remove o prefixo "Tipo:", pois agora est√° no grupo
        pill.innerHTML = `
            <span class="font-bold">${value}</span>
            <button type="button" aria-label="Remover filtro: ${type} - ${value}" class="ml-1.5 flex-shrink-0 p-0.5 rounded-full ${hoverClass} transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-purple-500">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        `;
        pill.querySelector('button').addEventListener('click', removeCallback);
        return pill;
    }

    /**
     * AJUSTE UX: Cria um container de grupo de p√≠lulas (Label + Lista).
     */
    function createPillGroup(groupName) {
        const groupWrapper = document.createElement('div');
        groupWrapper.className = 'pill-group';
        
        // Usamos textContent para a label para evitar problemas de HTML injection
        const label = document.createElement('span');
        label.className = 'pill-group-label';
        label.textContent = `${groupName}:`;
        
        const pillList = document.createElement('div');
        pillList.className = 'pill-list';
        
        groupWrapper.appendChild(label);
        groupWrapper.appendChild(pillList);
        return groupWrapper;
    }


    /**
     * AJUSTE UX: Atualiza o cont√™iner de p√≠lulas, agrupando-as por tipo.
     */
    function updateFilterPills(pillsContainerId, gridContainerId, searchInputId, applyFn) {
        const pillsContainer = document.getElementById(pillsContainerId);
        const gridContainer = document.getElementById(gridContainerId);
        const searchInput = document.getElementById(searchInputId);
        
        if (!pillsContainer || !gridContainer || !searchInput) return;

        pillsContainer.innerHTML = ''; // Limpa as p√≠lulas antigas
        let hasPills = false;

        // 1. P√≠lula de Busca
        const searchTerm = searchInput.value.trim();
        if (searchTerm) {
            hasPills = true;
            const group = createPillGroup('Busca'); // Cria o grupo
            const pill = createPill('Busca', searchTerm, () => {
                searchInput.value = '';
                applyFn();
            });
            group.querySelector('.pill-list').appendChild(pill); // Adiciona ao sub-container
            pillsContainer.appendChild(group);
        }

        // 2. P√≠lulas dos Multi-Selects
        const filterContainers = gridContainer.querySelectorAll('.multi-select-container');
        filterContainers.forEach(container => {
            const placeholder = container.querySelector('button').dataset.placeholder; // "Segmento", "Tags"
            const checkedInputs = container.querySelectorAll('input:checked');

            if (checkedInputs.length > 0) {
                hasPills = true;
                const group = createPillGroup(placeholder); // Cria um grupo para este tipo
                const pillList = group.querySelector('.pill-list');

                checkedInputs.forEach(input => {
                    const label = input.nextElementSibling.textContent; // Pega o texto do label

                    const pill = createPill(placeholder, label, () => {
                        input.checked = false;
                        updateMultiSelectButtonText(container); // Atualiza o (N) no bot√£o
                        applyFn();
                    });
                    pillList.appendChild(pill);
                });
                
                pillsContainer.appendChild(group);
            }
        });

        // Oculta o container principal se n√£o houver p√≠lulas
        pillsContainer.style.display = hasPills ? 'flex' : 'none';
    }


    // --- FUN√á√ïES E LISTENERS DO MODAL ---
    function openModal(modal) {
        focusedElementBeforeModal = document.activeElement;

        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.add('show');
            const closeButton = modal.querySelector('button[id^="close-"], button[id^="modal-close-"]');
            if (closeButton) {
                closeButton.focus();
            }
        }, 10);

        document.addEventListener('keydown', handleEscKey);
    }

    function closeModal(modal) {
        modal.classList.remove('show');
        document.removeEventListener('keydown', handleEscKey);

        setTimeout(() => {
            modal.classList.add('hidden');
            if (modal === influencerModal) {
                 modal.innerHTML = ''; // Limpa o conte√∫do ao fechar
            }
            if (focusedElementBeforeModal) {
                focusedElementBeforeModal.focus();
            }
        }, 300);
    }

    function handleEscKey(e) {
        if (e.key === 'Escape') {
            const activeModal = document.querySelector('.modal.show');
            if (activeModal) {
                closeModal(activeModal);
            }
        }
    }

    helpBtn.addEventListener('click', () => openModal(helpModal));
    closeHelpBtn.addEventListener('click', () => closeModal(helpModal));
    helpModal.addEventListener('click', e => { if(e.target === helpModal) closeModal(helpModal) });

    
    function openInfluencerModal(influencer, index) {
        influencerModal.setAttribute('aria-labelledby', 'modal-name');

        // === SUGEST√ÉO 4: Otimiza√ß√£o de SVG (Instagram)
        influencerModal.innerHTML=`
            <div class="modal-content relative bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto flex flex-col md:flex-row transform scale-95">

                <button id="modal-prev" aria-label="Influenciador anterior" class="modal-nav-btn left-2 text-purple-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>

                <div id="modal-img-container" class="w-full md:w-1/3 flex-shrink-0"></div>
                <div class="p-8 flex-grow">
                    <button id="modal-close-btn" aria-label="Fechar detalhes" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition-colors z-20"> <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                    <h2 id="modal-name" tabindex="-1" class="text-3xl font-bold mb-2 text-purple-900 outline-none"></h2>
                    <div id="modal-segmento-container" class="mb-6"></div>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-4 mb-6 text-sm">
                        <div id="modal-ig-container">
                           <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5 instagram-icon" role="img" viewBox="0 0 24 24"><use href="#icon-instagram" /></svg>
                                <p class="font-bold text-slate-800" id="modal-ig"></p>
                            </div>
                           <p class="text-slate-500 pl-7">Instagram</p>
                        </div>
                         <div id="modal-ttk-container"><div class="flex items-center space-x-2"><svg class="w-5 h-5" role="img" viewBox="0 0 24 24" fill="#000000"><title>TikTok</title><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-2.43.05-4.84-.95-6.43-2.8-1.59-1.87-2.32-4.2-1.86-6.33.36-1.72 1.46-3.2 3.02-4.06.38-.2.77-.38 1.16-.52.06-1.57.02-3.14.01-4.71.13-2.59 1.91-4.86 4.42-5.63 1.25-.38 2.5-.45 3.75-.28z"/></svg><p class="font-bold text-slate-800" id="modal-ttk"></p></div><p class="text-slate-500 pl-7">TikTok</p></div>
                            <div id="modal-yt-container"><div class="flex items-center space-x-2"><svg class="w-5 h-5" role="img" viewBox="0 0 24 24"><title>YouTube</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .498 6.186C0 8.07 0 12 0 12s0 3.93.498 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" fill="#FF0000"/></svg><p class="font-bold text-slate-800" id="modal-yt"></p></div><p class="text-slate-500 pl-7">YouTube</p></div>
                            <div><p class="font-bold text-slate-800" id="modal-orcamento"></p><p class="text-slate-500">Or√ßamento</p></div>
                            <div><p class="font-bold text-slate-800" id="modal-projeto"></p><p class="text-slate-500">Projeto</p></div>
                            <div><p class="font-bold text-slate-800" id="modal-agencia"></p><p class="text-slate-500">Ag√™ncia</p></div>
                    </div>
                    <div id="modal-escopo-container" class="mt-4"><h3 class="font-bold text-slate-800 mb-2">Escopo</h3><p id="modal-escopo" class="text-slate-600 text-base italic"></p></div>
                    <h3 class="font-bold text-slate-800 mb-2 mt-4">Mini Bio</h3>
                    <p id="modal-bio" class="text-slate-600 text-base leading-relaxed"></p>
                </div>

                <button id="modal-next" aria-label="Pr√≥ximo influenciador" class="modal-nav-btn right-2 text-purple-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>

                </button>
            </div>
        `;

        // --- Preenche o conte√∫do do modal ---
        const modalNameEl = document.getElementById('modal-name');
        modalNameEl.textContent = influencer.Influenciador;
        
        // AJUSTE Acessibilidade: Foca no novo t√≠tulo ao navegar
        modalNameEl.focus({ preventScroll: true });


        let modalSegmentHTML=`<p class="font-semibold text-lg bg-amber-100 text-amber-800 py-1 px-3 rounded-lg inline-block">${influencer.Segmento}</p>`;
        if(influencer.TagsSecundarias.length>0){
            modalSegmentHTML+='<div class="mt-3 flex flex-wrap gap-2">';
            influencer.TagsSecundarias.forEach(tag=>{modalSegmentHTML+=`<span class="font-semibold inline-block py-0.5 px-2 rounded-full text-[11px] ${getTagColorClasses(tag)}">${tag}</span>`});
            modalSegmentHTML+='</div>';
        }
        document.getElementById('modal-segmento-container').innerHTML=modalSegmentHTML;
        document.getElementById('modal-escopo').textContent=influencer.ESCOPO;
        document.getElementById('modal-bio').textContent=influencer['MINI BIO - INFLUENCIADOR'];
        const modalImgContainer=document.getElementById('modal-img-container');
        if(influencer.IMAGEM_URL){
            modalImgContainer.innerHTML=`<img src="${influencer.IMAGEM_URL}" alt="${influencer.Influenciador}" class="w-full h-full object-cover md:rounded-l-2xl rounded-t-2xl md:rounded-t-none">`;
        } else {
            const name=influencer.Influenciador||'',initials=name.split(' ').map(n=>n[0]).slice(0,2).join('');
            modalImgContainer.innerHTML=`<div class="w-full h-48 md:h-full flex items-center justify-center bg-amber-100 text-amber-800 md:rounded-l-2xl rounded-t-2xl md:rounded-t-none"><span class="text-7xl font-bold">${initials}</span></div>`;
        }
        document.getElementById('modal-ig-container').style.display=influencer.FollowersIG>0?'block':'none';
        document.getElementById('modal-ttk-container').style.display=influencer.FollowersTTK>0?'block':'none';
        document.getElementById('modal-yt-container').style.display=influencer.FollowersYT>0?'block':'none';
        document.getElementById('modal-ig').textContent=formatNumber(influencer.FollowersIG);
        document.getElementById('modal-ttk').textContent=formatNumber(influencer.FollowersTTK);
        document.getElementById('modal-yt').textContent=formatNumber(influencer.FollowersYT);
        document.getElementById('modal-orcamento').textContent=influencer['Or√ßamento (Aproximado)'];
        document.getElementById('modal-projeto').textContent=influencer.PROJETOS;
        document.getElementById('modal-agencia').textContent=influencer.AG√äNCIA;

        // --- L√≥gica dos bot√µes de navega√ß√£o ---
        const prevBtn = document.getElementById('modal-prev');
        const nextBtn = document.getElementById('modal-next');
        const closeModalBtn = document.getElementById('modal-close-btn');

        // L√≥gica "Anterior"
        if (index !== undefined && index > 0) {
            prevBtn.disabled = false;
            prevBtn.onclick = () => { // Usando onclick para sobrescrever o anterior
                openInfluencerModal(currentFilteredInfluencers[index - 1], index - 1);
            };
        } else {
            prevBtn.disabled = true;
            prevBtn.onclick = null; // Remove listener
        }

        // L√≥gica "Pr√≥ximo"
        if (index !== undefined && index < currentFilteredInfluencers.length - 1) {
            nextBtn.disabled = false;
             nextBtn.onclick = () => { // Usando onclick para sobrescrever o anterior
                 openInfluencerModal(currentFilteredInfluencers[index + 1], index + 1);
            };
        } else {
            nextBtn.disabled = true;
            nextBtn.onclick = null; // Remove listener
        }

        // --- Listeners do Modal ---
        closeModalBtn.onclick = () => closeModal(influencerModal); // Usando onclick para sobrescrever

        if (!influencerModal.classList.contains('show')) {
            influencerModal.onclick = null;
            influencerModal.onclick = (e) => {
                if (e.target === influencerModal) {
                    closeModal(influencerModal);
                }
            };
            openModal(influencerModal);
        }
    }


    // --- LISTENERS GERAIS (SCROLL, TABS) ---
    searchInput.addEventListener('input', debounce(applyFilters, 300));
    searchInputCouples.addEventListener('input', debounce(applyCouplesFilters, 300));

    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) scrollTopBtn.classList.remove('hidden');
        else scrollTopBtn.classList.add('hidden');

        const isNearBottom = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 200;

        if (isNearBottom) {
            if (!mainPanel.classList.contains('hidden') && (currentPageInfluencers - 1) * itemsPerPageInfluencers < currentFilteredInfluencers.length) {
                loadMoreInfluencers();
            } else if (!couplesPanel.classList.contains('hidden') && (currentPageCouples - 1) * itemsPerPageCouples < currentFilteredCouples.length) {
                loadMoreCouples();
            }
        }
    });

    scrollTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    
    // AJUSTE UX: L√≥gica das abas com classes Ativo/Inativo
    const activeTabClasses = ['bg-amber-600', 'text-white', 'hover:bg-amber-700'];
    const inactiveTabClasses = ['bg-slate-200', 'text-slate-700', 'hover:bg-slate-300'];

    showInfluencersBtn.addEventListener('click',()=>{
        mainPanel.classList.remove('hidden');
        couplesPanel.classList.add('hidden');
        
        // Bot√£o "Painel" (Ativo)
        showInfluencersBtn.classList.add(...activeTabClasses);
        showInfluencersBtn.classList.remove(...inactiveTabClasses);
        
        // Bot√£o "Casais" (Inativo)
        showCouplesBtn.classList.add(...inactiveTabClasses);
        showCouplesBtn.classList.remove(...activeTabClasses);

        showInfluencersBtn.setAttribute('aria-selected', 'true');
        showCouplesBtn.setAttribute('aria-selected', 'false');
    });

    showCouplesBtn.addEventListener('click',()=>{
        mainPanel.classList.add('hidden');
        couplesPanel.classList.remove('hidden');

        // Bot√£o "Casais" (Ativo)
        showCouplesBtn.classList.add(...activeTabClasses);
        showCouplesBtn.classList.remove(...inactiveTabClasses);

        // Bot√£o "Painel" (Inativo)
        showInfluencersBtn.classList.add(...inactiveTabClasses);
        showInfluencersBtn.classList.remove(...activeTabClasses);

        showInfluencersBtn.setAttribute('aria-selected', 'false');
        showCouplesBtn.setAttribute('aria-selected', 'true');
        
        // Garante que os filtros de casais sejam aplicados (e p√≠lulas atualizadas) ao trocar de aba
        applyCouplesFilters();
    });

    // --- INICIALIZA√á√ÉO ---
    
    // Verifica se os dados (rawData e couplesData) existem (do dados.js)
    if (typeof rawData === 'undefined' || typeof couplesData === 'undefined') {
        console.error("Erro: Arquivo 'dados.js' n√£o foi carregado ou est√° vazio.");
        loader.innerHTML = '<p class="text-red-600 font-bold">Erro ao carregar os dados. Verifique o console.</p>';
        return;
    }
    
    allInfluencers = processData(rawData);
    allCouples = processCouplesData(couplesData);

    populateFilters();
    populateCouplesFilters();

    setupClearButton(clearFiltersBtn, filtersGrid, searchInput, applyFilters);
    setupClearButton(clearFiltersCouplesBtn, filtersGridCouples, searchInputCouples, applyCouplesFilters);

    // Carga inicial
    applyFilters();

    // Define o estado inicial dos bot√µes "Limpar"
    checkClearButtonState(searchInput, filtersGrid, clearFiltersBtn);
    checkClearButtonState(searchInputCouples, filtersGridCouples, clearFiltersCouplesBtn);
});
</script>

</body>
</html>
